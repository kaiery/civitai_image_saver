# Civitai Image Saver (CIS)

[![Version](https://img.shields.io/badge/version-1.0-blue.svg)](https://github.com/kaiery/civitai_image_saver)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

**Civitai Image Saver** 是一款为 Civitai (C站) 用户设计的增强型油猴脚本（Userscript）。它旨在简化图片及其元数据的保存流程，让您能够轻松管理和备份在 C 站看到的优质生成作品及其生成参数。

---

## ✨ 核心功能

- **🚀 一键快速保存**:
  在浏览模型详情页时，脚本会在每张图片的左上角自动添加一个 **"SAVE"** 浮动角标。点击即可同时下载：
  1. **原图文件**（自动获取最高清晰度且尝试强制重命名）。
  2. **JSON 元数据**（包含完整的 Prompt、Negative Prompt、Seed、Sampler 等生成参数）。

- **📊 状态追踪与管理**:
  - **视觉反馈**: 已点击保存的图片角标会从蓝色 "SAVE" 变为绿色 **"SAVED"**，方便追踪哪些图片已备份。
  - **持久化记录**: 自动记录已下载图片的 ID、所属模型 ID、版本 ID 及保存时间。

- **📦 强大的导入导出**:
  通过右下角的 **CIS 管理面板**，您可以：
  - **导出数据**: 将所有保存记录导出为标准的 JSON 文件。
  - **导入数据**: 支持 **合并模式**（根据时间戳更新记录）和 **覆盖模式**（替换本地记录），实现跨设备数据同步。

- **🧹 智能自动命名**:
  自动清理模型名称中的非法字符，将下载文件命名为：`[模型名]_[版本名]_[图片ID].[后缀]`，方便本地整理。

---

## 🛠 安装说明

1. **安装脚本管理器**:
   在浏览器中安装 [Tampermonkey](https://www.tampermonkey.net/)（推荐）或 Violentmonkey 插件。
2. **获取脚本**:
   将 `civitai_image_saver.js` 的源码复制并新建到您的脚本管理器中。
3. **启用脚本**:
   确保脚本处于启用状态，然后打开或刷新 C 站模型页面（例如 `https://civitai.com/models/xxxx`）。

---

## 📖 使用指南

### 1. 保存图片

- 进入任意模型页面，等待页面加载完成。
- 鼠标悬停在感兴趣的图片上，点击出现的蓝色 **"SAVE"** 按钮。
- 浏览器会自动弹出下载任务（由于浏览器安全机制，第一次点击可能会请求下载权限，请选择“允许”）。

### 2. 数据管理 (CIS 面板)

- 点击页面右下角的蓝色按钮 **"CIS"** 打开管理面板。
- **导出数据**: 点击 "导出数据 (JSON)" 将本地记录保存到文件。
- **导入数据**: 点击 "导入数据 (JSON)" 选择之前的记录文件，并根据提示选择合并或覆盖。

### 3. 下载提示

- 脚本会自动尝试从 API 获取图片的生成元数据。如果 API 请求失败，脚本仍会尝试下载图片，并在日志中记录异常。

---

## ⚠ 注意事项

1. **下载权限**: 脚本使用了浏览器的 `download` 特性，请确保浏览器未阻止多文件下载。
2. **API 延迟**: 元数据的提取依赖于 C 站的内部 API，在高负载情况下可能会有延迟。
3. **隐私说明**: 本脚本所有数据均存储在浏览器的 `localStorage` 中，不会上传至第三方服务器。

---

## 📜 更新日志

### v1.0

- 实现一键保存原图及元数据
- 增加数据导出导入与合并功能
- 优化 UI 三色交互效果
- 引入状态追踪（SAVED 标记）

---

## 🤝 贡献与反馈

如果您在使用过程中遇到任何问题或有改进建议，欢迎提交 Issue。

**Author**: kaiery  
**License**: MIT
